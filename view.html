<html>
  <head>
    <meta charset="UTF-8" />
    <script src="node_modules/chart.js/dist/Chart.bundle.min.js"></script>
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
  </head>
  <body>
    <div class="text"></div>
    <canvas id="myChart" width="400" height="400"></canvas>
    <script>
      var ctx = document.getElementById("myChart");
      chartData = {
        datasets: [
          {
            data: [10, 20, 30],
            backgroundColor: ["red", "yellow", "blue"]
          }
        ],

        // These labels appear in the legend and in the tooltips when hovering different arcs -->
        labels: ["Red", "Yellow", "Blue"]
      };

      chartData = { datasets: [], labels: [] };
      var j = null;
      $.getJSON("data.json", data => {
        j = data["October2018"];
        $(".text").text(JSON.stringify(j, null, 2));
        console.log(j); // this will show the info it in firebug console
        $.getJSON("categorizer.json", categories => {
          filteredData = filterByCategory(
            categories.out.food.supermarket,
            data
          );
          chartData.datasets.push({
            data: filteredData.map(el => {
              return Math.abs(el.value);
            })
          });
          chartData.labels.push(
            ...filteredData.map(el => {
              return el.category;
            })
          );
        });
      });

      var myChart = new Chart(ctx, {
        type: "doughnut",
        data: chartData,
        options: { cutoutPercentage: 60 }
      });

      function filterByCategory(categoryItems, data) {
        let returnValue = Object.keys(categoryItems).map(elem => {
          return { category: elem, value: 0 };
        });
        Object.keys(data).forEach((month, index) => {
          Object.keys(data[month]).forEach((day, index) => {
            for (index in data[month][day]) {
              elem = data[month][day][index];
              for (category in categoryItems) {
                if (categoryItems[category].includes(elem.info)) {
                  returnValue[
                    indexOf(returnValue, category)
                  ].value += +elem.amount;
                  break;
                }
              }
            }
          });
        });
        return returnValue;
      }

      function indexOf(list, category) {
        for (el in list) {
          if (list[el].category === category) {
            return el;
          }
        }
      }
    </script>
  </body>
</html>
